<?php require('utils.php'); ?><!doctype html public "-//W3C//DTD HTML 4.0 //EN"> <html><head><title>Query TimeBank (<?php echo $_SERVER['SERVER_NAME'] ?>)</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="timebank.css" rel="stylesheet" type="text/css"><style type="text/css"><!--.button { 	background-color: #ccccff;	font-weight: bold; }--></style><script language="JavaScript" type="text/JavaScript"><!--function MM_goToURL() { //v3.0  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");}//--></script></head><body><?php readfile("topnav.php"); ?><h2>&nbsp;Query TimeBank</h2><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=POST>  <table cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td><input name="submit" type=submit class=button value="qT-E">       <td>&nbsp;       <td><input name="rel" size=20 value=<?php echo $HTTP_POST_VARS['rel'] ?>>       <td>&nbsp;       <td><input name="s" size=20 value=<?php echo $HTTP_POST_VARS['s'] ?>>   </table></form><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=POST>  <table cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td><input name="submit" type=submit class=button value="qR(E-E)">       <td>&nbsp;       <td><input name="s1" size=20 value=<?php echo $HTTP_POST_VARS['s1'] ?>>       <td>&nbsp;       <td><input name="s2" size=20 value=<?php echo $HTTP_POST_VARS['s2'] ?>>   </table></form><p><?php$submit = $HTTP_POST_VARS['submit'];$searchmax = 250;echo "QUERY TYPE: $submit<p>\n";if ($submit == "qT-E") {	$rel = $HTTP_POST_VARS['rel'];	$s = $HTTP_POST_VARS['s'];		if ($rel) {	  $q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str2='$s' AND eid1=''";	} else {		$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str2='$s' AND eid1=''";	}	//$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s2' AND str2='$s1' AND tid1='' AND tid2=''";	  	$result1 = mysql_query($q1, $db_conn);    	$num_rows1 = mysql_num_rows($result1);  	if (mysql_errno()) { printMySqlErrors($q,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  	//$result2 = mysql_query($q2, $db_conn);    	//$num_rows2 = mysql_num_rows($result2);  	//if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  	$rows = Array();  	$count = 0;  	while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 		$rows[] = $row; 		$count++; }  	//while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 	//	$rows[] = $row; 	//	$count++; }}if ($submit == "qR(E-E)") {	$s1 = $HTTP_POST_VARS['s1'];	$s2 = $HTTP_POST_VARS['s2'];		$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s1' AND str2='$s2' AND tid1='' AND tid2=''";	$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s2' AND str2='$s1' AND tid1='' AND tid2=''";	  	$result1 = mysql_query($q1, $db_conn);    	$num_rows1 = mysql_num_rows($result1);  	if (mysql_errno()) { printMySqlErrors($q,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  	$result2 = mysql_query($q2, $db_conn);    	$num_rows2 = mysql_num_rows($result2);  	if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  	$rows = Array();  	$count = 0;  	while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 		$rows[] = $row; 		$count++; }  	while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 		$rows[] = $row; 		$count++; }}?><table bgcolor='#ddffdd' cellpadding=2><tr><td><?phpif ($count == 0) {	echo "No matches";} else {	if ($submit == "qT-E") {		echoReultsQTE($rows);	} elseif ($submit == "qR(E-E)") {		echoResultsQREE($rows);	}}?></td></tr></table></td></tr></table></body></html>