<?php require('utils.php'); ?><!doctype html public "-//W3C//DTD HTML 4.0 //EN"> <html><head><title>Query TimeBank (<?php echo $_SERVER['SERVER_NAME'] ?>)</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="timebank.css" rel="stylesheet" type="text/css"><style type="text/css"><!--.button { 	background-color: #ccccff;	font-weight: bold; }--></style><script language="JavaScript" type="text/JavaScript"><!--function MM_goToURL() { //v3.0  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");}function MM_jumpMenu(targ,selObj,restore){ //v3.0  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");  if (restore) selObj.selectedIndex=0;}function openExamples(queryType) {	window.open("query-examples.php?queryType="+queryType,				"Query Examples",				"width=600,height=150,status=no,scrollbars=yes,resizable=yes"); }//--></script></head><body><?php //readfile("topnav.php");$submit = $HTTP_GET_VARS['submit'];if (! $submit) { $submit = "qT-E"; };$searchmax = 250;$queries = array("qT-E","qE-T","qE-E","qR(E-T)","qR(E-E)");?><h2>Query TimeBank</h2><!-- QUERY TYPE SELECTOR --><form name="form1" method="GET" action="">  <table width="600" cellpadding=5 bgcolor='#ffffaa'>  <tr><td>Please select the query type&nbsp;  <select name="menu1" onChange="MM_jumpMenu('parent',this,0)">	<?php	foreach ($queries as $query) {		echo '    <option value="query2.php?submit='.$query.'"';		if ($submit == $query) { echo " selected"; }		echo ">".$query."</option>\n";	}	?>  </select>  </table></form><!-- qT-E QUERIES --><?php if ($submit == 'qT-E') { ?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=GET>  <table width="600" cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td valign=top width=60pt>	    <input name="submit" type=submit class=button value='qT-E'>       <td align=left>	    Anchorings for Event		<input name="s" size=15 value=<?php echo $HTTP_GET_VARS['s'] ?>>		<p>        Relation constrained by 		<input name="rel" size=15 value=<?php echo $HTTP_GET_VARS['rel'] ?>>    <tr>       <td colspan="2">What time expressions is Event anchored to? Anchoring relation         can be contrained by a TimeML relation like DURING or AFTER. If no constraint         is entered then all anchorings will be retrieved.  </table></form><!-- qE-E QUERIES --><?php } elseif ($submit == 'qE-E') { ?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=GET>  <table width="600" cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td valign=top width=60pt>	    <input name="submit" type=submit class=button value='qE-E'>       <td>	    Orderings for Event&nbsp		<input name="s" size=15 value=<?php echo $HTTP_GET_VARS['s'] ?>>        <p>		Relation constrained by&nbsp        <input name="rel" size=15 value=<?php echo $HTTP_GET_VARS['rel'] ?>>    <tr>       <td colspan="2">		What events is Event related to? Ordering relation         can be contrained by a TimeML relation like DURING or AFTER. If no constraint         is entered then all orderings will be retrieved.  </table></form><!-- qE-T QUERIES --><?php } elseif ($submit == 'qE-T') { ?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=GET>  <table width="600" cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td valign=top width=60pt>	    <input name="submit" type=submit class=button value='qE-T'>       <td>	    Orderings relative to Time&nbsp		<input name="s" size=15 value=<?php echo $HTTP_GET_VARS['s'] ?>>        <p>		Relation constrained by&nbsp        <input name="rel" size=15 value=<?php echo $HTTP_GET_VARS['rel'] ?>>    <tr>       <td colspan="2">		What events are ordered relative to Time? The ordering relation         can be contrained by a TimeML relation like DURING or AFTER. If no constraint         is entered then all orderings will be retrieved.  </table></form><!-- qR(E-E) QUERIES --><?php } elseif ($submit == 'qR(E-E)') { ?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=GET>  <table width="600" cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td valign=top>	    <input name="submit" type=submit class=button value='qR(E-E)'>       <td>		Relations between Event <input name="s1" size=15 value=<?php echo $HTTP_GET_VARS['s1'] ?>>        and Event <input name="s2" size=15 value=<?php echo $HTTP_GET_VARS['s2'] ?>>     <tr>      <td colspan="2">	    <p>What temporal relations hold between the two events? 		<a href=javascript:openExamples("qR(E-E)")>Example queries.</a>     </table></form><!-- qR(E-T) QUERIES --><?php } elseif ($submit == 'qR(E-T)') { ?><form action="<?php echo $_SERVER['PHP_SELF'] ?>" method=GET>  <table width="600" cellpadding=5 bgcolor='#ffffaa'>    <tr>       <td valign=top>	    <input name="submit" type=submit class=button value='qR(E-T)'>       <td>		Relations between Event <input name="s1" size=15 value=<?php echo $HTTP_GET_VARS['s1'] ?>>        and Time <input name="s2" size=15 value=<?php echo $HTTP_GET_VARS['s2'] ?>>     <tr>      <td colspan="2">		<p>	    <font color=#cc0000>Not yet implemented</font><br>	    What temporal relations hold between the Event and the Time?		<a href=javascript:openExamples("qR(E-T)")>Example queries.</a>     </table></form><?php} else {	if ($submit) { echo "Query type not yet implemented"; }}?>  <p><?phpif ($submit == 'qT-E'){	$rel = $HTTP_GET_VARS['rel'];	$s = $HTTP_GET_VARS['s'];		if ($s) {		$searched = 1;		if ($rel) {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str2='$s' AND eid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str1='$s' AND eid2=''";		} else {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str2='$s' AND eid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s' AND eid2=''";		}		  	$result1 = mysql_query($q1, $db_conn);    		$num_rows1 = mysql_num_rows($result1);  		if (mysql_errno()) { printMySqlErrors($q1,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }	  	$result2 = mysql_query($q2, $db_conn);    		$num_rows2 = mysql_num_rows($result2);  		if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  		$rows = Array();  		$count = 0;  		while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }  		while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }	}}if ($submit == 'qE-T'){	$rel = $HTTP_GET_VARS['rel'];	$s = $HTTP_GET_VARS['s'];		if ($s) {		$searched = 1;		if ($rel) {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str2='$s' AND tid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str1='$s' AND tid2=''";		} else {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str2='$s' AND tid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s' AND tid2=''";		}		  	$result1 = mysql_query($q1, $db_conn);    		$num_rows1 = mysql_num_rows($result1);  		if (mysql_errno()) { printMySqlErrors($q1,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }	  	$result2 = mysql_query($q2, $db_conn);    		$num_rows2 = mysql_num_rows($result2);  		if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  		$rows = Array();  		$count = 0;  		while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }  		while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }	}}if ($submit == 'qE-E'){	$rel = $HTTP_GET_VARS['rel'];	$s = $HTTP_GET_VARS['s'];	if ($s) {		$searched = 1;		if ($rel) {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str2='$s' AND tid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE reltype='$rel' AND str1='$s' AND tid2=''";		} else {			$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str2='$s' AND tid1=''";			$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s' AND tid2=''";		}		  	$result1 = mysql_query($q1, $db_conn);    		$num_rows1 = mysql_num_rows($result1);  		if (mysql_errno()) { printMySqlErrors($q1,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }	  	$result2 = mysql_query($q2, $db_conn);    		$num_rows2 = mysql_num_rows($result2);  		if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }  		$rows = Array();  		$count = 0;  		while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }  		while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }	}}if ($submit == 'qR(E-E)') {	$s1 = $HTTP_GET_VARS['s1'];	$s2 = $HTTP_GET_VARS['s2'];	if ($s1 and $s2) {		$searched = 1;		$q1 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s1' AND str2='$s2' AND tid1='' AND tid2=''";		$q2 = "SELECT * from $EXPANDED_TLINKS_TABLE WHERE str1='$s2' AND str2='$s1' AND tid1='' AND tid2=''";		  	$result1 = mysql_query($q1, $db_conn);    		$num_rows1 = mysql_num_rows($result1);  		if (mysql_errno()) { printMySqlErrors($q,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }	  	$result2 = mysql_query($q2, $db_conn);    		$num_rows2 = mysql_num_rows($result2);  		if (mysql_errno()) { printMySqlErrors($q2,$_SERVER['SCRIPT_NAME'] . ":" . __LINE__); }	  	$rows = Array();  		$count = 0;  		while ($row = mysql_fetch_assoc($result1) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }  		while ($row = mysql_fetch_assoc($result2) and $count < $searchmax) { 			$rows[] = $row; 			$count++; }	} else {		$warning = "WARNING: you must enter two events";	}}?><table bgcolor='#ddffdd' cellpadding=2><tr><td><?phpif ($warning) {	echo $warning;} elseif ($searched) {	if ($count == 0) {		echo "No matches";	} else {		if ($submit == "qT-E") {			echoResultsQTE($rows);		} elseif ($submit == "qE-T") {			echoResultsQTE($rows);		} elseif ($submit == "qE-E") {			echoResultsQTE($rows);		} elseif ($submit == "qR(E-E)") {			echoResultsQREE($rows);		}	}}?></td></tr></table></body></html>