<?php require('utils.php');$debug = true;$debug = false;if ($debug) { printVars(); }$login = $HTTP_GET_VARS['login'];$file = $HTTP_GET_VARS['file'];	function getSentences($file) {	global $SENTENCES_TABLE;	#$query = "SELECT * FROM $SENTENCES_TABLE WHERE file='$file';";	$q = "select file, sentID, count(sentID), sentence from $SENTENCES_TABLE WHERE file = '$file' group by sentID";		$rows = dbSelect($q, 'getSentences');	return $rows;		}function getMainEvents($file) {	# This one used to only search for main events created by the	# current login, which worked when ish97 was the only annotator	# for our little experiment. We now simply assume that there	# is one set of main events annotations for each file. This	# may break when accidentally two annotators do the same file	# for main events.	# Used to be called function getAnnotations($login,$file) 	global $MAINEVENTS_TABLE;	global $debug;	# $query = "SELECT eventID FROM $MAINEVENTS_TABLE WHERE file='$file' and annotator ='$login';";	$query = "SELECT eventID FROM $MAINEVENTS_TABLE WHERE file='$file';";	$rows = dbSelect($query, 'getAnnotations');	$eids = array();	foreach ($rows as $row) {		$eids[$row[0]] = 1;	}	if ($debug) {		echo "MAIN EVENTS: <blockquote>";		print_r($eids);		echo "</blockquote>\n";	}	return $eids;		}function getReltypes($file) {	global $MAINEVENT_RELTYPES_TABLE;	global $debug;	$query = "SELECT annotator, events, reltype FROM $MAINEVENT_RELTYPES_TABLE WHERE file='$file';";	$rows = dbSelect($query, 'getReltypes');	$rels = array();	foreach ($rows as $row) {		$ann = $row[0];		$events = $row[1];		$rel = $row[2];		$rels[$events][$ann] = $rel;	}	if ($debug) {		echo "<p>RELTYPES: ";		echo "<blockquote><pre>";		print_r($rels);		echo "</pre></blockquote><p>\n"; }	return $rels;}function getAdjudicatedReltypes($file) {	global $ADJUDICATED_MAINEVENT_RELTYPES_TABLE;	global $debug;	$query = "SELECT events, reltype FROM $ADJUDICATED_MAINEVENT_RELTYPES_TABLE WHERE file='$file';";	$rows = dbSelect($query, 'getAdjudicatedReltypes');	$rels = array();	foreach ($rows as $row) {		$events = $row[0];		$rel = $row[1];		$rels[$events] = $rel;	}	if ($debug) {		echo "<p>ADJUDICATED RELTYPES: ";		echo "<blockquote><pre>";		print_r($rels);		echo "</pre></blockquote><p>\n"; }	return $rels;}function abbreviateRel($string){	if ($string == 'BEFORE') { return 'B'; }	if ($string == 'AFTER') { return 'A'; }	if ($string == 'OVERLAP') { return 'O'; }	if ($string == 'BEFORE-OR-OVERLAP') { return 'BO'; }	if ($string == 'OVERLAP-OR-AFTER') { return 'OA'; }	if ($string == 'VAGUE') { return 'V'; }	return $string;}function normalizeEventMarkup($string){	# normalize event markup in the sentence, necessary	# because EVENT and TARGETEVENT are mixed	$string = str_replace('<TARGETEVENT', '<EVENT', $string);	$string = str_replace('</TARGETEVENT', '</EVENT', $string);	$string = str_replace('<EVENT', '[<EVENT', $string);	$string = str_replace('</EVENT>', '</EVENT>]', $string);	return $string;}function addRadioButtons($string){	# add-in the radio buttons	$pattern = '/(<EVENT stem="\S+" aspect="\S+" eid="(e\d+))/';	$replacement = "<input type=radio name=$id value=\$2> \$1";	$string = preg_replace($pattern, $replacement, $string);	return $string;}?><!doctype html public "-//W3C//DTD HTML 4.0 //EN"> <html><head><title>TempEval Document <?php echo $file ?> (<?php echo $login ?>)</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="tempeval.css" rel="stylesheet" type="text/css"></head><body><h2>TempEval Document <?php echo $file ?></h2><hr><FORM action="adminSubmit.php" method="post"><input type="hidden" name="login" value="<?php echo $login; ?>" /><input type="hidden" name="file" value="<?php echo $file; ?>" /><?php	$sentences = getSentences($file);	$eids = getMainEvents($file);	$rels = getReltypes($file);	$adjrels = getAdjudicatedReltypes($file);	echo "<p>\n";	echo "<table cellpadding=3 border=0>\n";	$count = 0;		$MAINEVENTS = array();	foreach ($sentences as $sentence)	{		$id = $sentence[1];		$lid = $sentence[2];		$string = $sentence[3];				$string = normalizeEventMarkup($string);		# get all events from the sentence		preg_match_all('/eid="(e\d+)"/', $string, $matches);		#echo '<p>'; print_r($matches[1]); echo '<p>';		# see whether one was marked as the main event				$hasMainEvent = 0;		$mainEvent = '';		foreach ($matches[1] as $eid) {			if ($eids[$eid]) {				$hasMainEvent = 1;				$mainEvent = $eid;			}		} 		if ($hasMainEvent) {			$MAINEVENTS[$id] = $mainEvent;		}	}		if ($debug) {		print_r($MAINEVENTS);		echo "<p>\n"; }  		foreach ($sentences as $sentence) 	{		$count = $count + 1;		$id = $sentence[1];		$lid = $sentence[2];		$string = $sentence[3];				$string = normalizeEventMarkup($string);#		$string = addRadioButtons($string);		# add-in the radio buttons		$pattern = '/(<EVENT stem="\S+" aspect="\S+" eid="(e\d+))/';		$replacement = "<input type=radio name=$id value=\$2> \$1";		$string = preg_replace($pattern, $replacement, $string);		$numberOfEvents = substr_count($string, '<EVENT ');		# get all events from the sentence		preg_match_all('/eid="(e\d+)"/', $string, $matches);		#echo '<p>'; print_r($matches[1]); echo '<p>';		# see whether one was marked as the main event				$hasMainEvent = 0;		$mainEvent = '';		foreach ($matches[1] as $eid) {			if ($eids[$eid]) {				$hasMainEvent = 1;				$mainEvent = $eid;			}		} 		$string = preg_replace('/<input/', '<xinput', $string);		$string = preg_replace('/<EVENT/', '<XEVENT', $string);		if ($numberOfEvents == 1) {			$pattern = '/<xinput type=radio name=(\d+) value=(e\d+)> <XEVENT/';			$replacement = '<xinput type=radio name=$1 value=$2 checked> <EVENT';			$string = preg_replace($pattern, $replacement, $string);		} elseif ($hasMainEvent == 1) {			$pattern = "/<xinput type=radio name=(\d+) value=($mainEvent)> <XEVENT/";			$replacement = '<xinput type=radio name=$1 value=$2 checked> <EVENT/';			$string = preg_replace($pattern, $replacement, $string);		}		echo "<tr>\n";		echo "  <td valign=top>$id\n";#		echo "  <td valign=top>$mainEvent\n";		echo "  <td valign=top>";		if ($id == 0) {			echo "<TARGETTIMEX3>$string</TARGETTIMEX3>\n";		} else {			echo "$string\n";		}				$mainevent1 = $MAINEVENTS[$id];		$mainevent2 = $MAINEVENTS[$id+1];		if ($mainevent1 and $mainevent2) {			$pair = '(' . $mainevent1 . '-' . $mainevent2 . ')';			$rels_for_pair = $rels[$pair];			#print_r($rels_for_pair);			$annotators = array_keys($rels_for_pair);			$ann1 = $annotators[0];			$ann2 = $annotators[1];			$rel1 = abbreviateRel($rels_for_pair[$ann1]);			$rel2 = abbreviateRel($rels_for_pair[$ann2]);			$rel = '';			if ($rel1 == $rel2) {				$rel = $rels_for_pair[$ann1]; }			if ($adjrels[$pair]) {				$rel = $adjrels[$pair]; }				$checkedB = '';			$checkedA = '';			$checkedO = '';			$checkedV = '';			$checkedBO = '';			$checkedOA = '';			$checkedBA = '';			$checkedNR = '';			if ($rel == 'BEFORE') { $checkedB = ' checked'; }			if ($rel == 'AFTER') { $checkedA = ' checked'; }			if ($rel == 'OVERLAP') { $checkedO = ' checked'; }			if ($rel == 'VAGUE') { $checkedV = ' checked'; }			if ($rel == 'BEFORE-OR-OVERLAP') { $checkedBO = ' checked'; }			if ($rel == 'OVERLAP-OR-AFTER') { $checkedOA = ' checked'; }			if ($rel == 'BEFORE-OR-AFTER') { $checkedBA = ' checked'; }			if ($rel == 'NON-RELATED') { $checkedNR = ' checked'; }						echo "<tr>\n";			echo "  <td>&nbsp;\n";			echo "  <td valign=top colspan=2>\n";						echo "    ";			if ($rel1 != $rel2) { echo "<font color=red><strong>"; }			echo "$rel1:$rel2";			if ($rel1 != $rel2) { echo "</strong></font>"; 	}			echo "&nbsp;&nbsp;\n";			if ($debug) { echo "    $pair\n"; }			echo "    <input type=radio name=$pair value=B$checkedB>B\n";			echo "    <input type=radio name=$pair value=O$checkedO>O\n";			echo "    <input type=radio name=$pair value=A$checkedA>A\n";			echo "    <input type=radio name=$pair value=BO$checkedBO>BO\n";			echo "    <input type=radio name=$pair value=OA$checkedOA>OA\n";			echo "    <input type=radio name=$pair value=V$checkedV>V\n";		}			}	echo "</table>\n";?><p><input type="submit" value="Submit Judgements" /></p></FORM>
<form action="adminArticles.php" method="get"><input type="hidden" name="login" value="<?php echo $login; ?>" /><input type="submit" value="Document List" /></form><hr><!--<table><tr><td>  <form action="index.php" method="get">  <input type="hidden" name="login" value="<?php echo $login; ?>" />  <input type="submit" value="Home" />  </form><td>  <form action="articles.php" method="get">  <input type="hidden" name="login" value="<?php echo $login; ?>" />  <input type="submit" value="Document List" />  </form></table>--></body></html>