<?php require('utils.php');$debug = false;if ($debug) { printVars(); }$login = $HTTP_GET_VARS['login'];$file = $HTTP_GET_VARS['file'];	function getSentences($login,$file) {	global $SENTENCES_TABLE;	#$query = "SELECT * FROM $SENTENCES_TABLE WHERE file='$file';";	$q = "select file, sentID, count(sentID), sentence from $SENTENCES_TABLE WHERE file = '$file' group by sentID";		$rows = dbSelect($q, 'getSentences');	return $rows;		}function getAnnotations($login,$file) {	# This one used to only search for main events created by the	# current login, which worked when ish97 was the only annotator	# for our little experiment. We now simply assume that there	# is one set of main events annotations for each file. This	# may break when accidentally two annotators do the same file	# for main events.	global $MAINEVENTS_TABLE;	# $query = "SELECT eventID FROM $MAINEVENTS_TABLE WHERE file='$file' and annotator ='$login';";	$query = "SELECT eventID FROM $MAINEVENTS_TABLE WHERE file='$file';";	$rows = dbSelect($query, 'getAnnotations');	$eids = array();	foreach ($rows as $row) {		$eids[$row[0]] = 1;	}	if ($debug) {		print_r($eids);		echo "<br>\n"; }	return $eids;		}function getReltypes($login,$file) {	global $MAINEVENT_RELTYPES_TABLE;	$query = "SELECT events, reltype FROM $MAINEVENT_RELTYPES_TABLE WHERE file='$file' and annotator ='$login';";	$rows = dbSelect($query, 'getReltypes');	$eids = array();	foreach ($rows as $row) {		$eids[$row[0]] = $row[1];	}	if ($debug) {		print_r($eids);		echo "<br>\n"; }	return $eids;		}function normalizeEventMarkup($string){	# normalize event markup in the sentence, necessary	# because EVENT and TARGETEVENT are mixed	$string = str_replace('<TARGETEVENT', '<EVENT', $string);	$string = str_replace('</TARGETEVENT', '</EVENT', $string);	$string = str_replace('<EVENT', '[<EVENT', $string);	$string = str_replace('</EVENT>', '</EVENT>]', $string);	return $string;}function addRadioButtons($string){	# add-in the radio buttons	$pattern = '/(<EVENT stem="\S+" aspect="\S+" eid="(e\d+))/';	$replacement = "<input type=radio name=$id value=\$2> \$1";	$string = preg_replace($pattern, $replacement, $string);	return $string;}?><!doctype html public "-//W3C//DTD HTML 4.0 //EN"> <html><head><title>TempEval Document <?php echo $file ?> (<?php echo $login ?>)</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><link href="tempeval.css" rel="stylesheet" type="text/css"></head><body><h2>TempEval Document <?php echo $file ?></h2><hr><FORM action="submit.php" method="post"><input type="hidden" name="login" value="<?php echo $login; ?>" /><input type="hidden" name="file" value="<?php echo $file; ?>" /><?php	$sentences = getSentences($login,$file);	$eids = getAnnotations($login,$file);	$rels = getReltypes($login,$file);	echo "<table cellpadding=3 border=0>\n";	$count = 0;		$MAINEVENTS = array();	foreach ($sentences as $sentence)	{		$id = $sentence[1];		$lid = $sentence[2];		$string = $sentence[3];				$string = normalizeEventMarkup($string);		# get all events from the sentence		preg_match_all('/eid="(e\d+)"/', $string, $matches);		#echo '<p>'; print_r($matches[1]); echo '<p>';		# see whether one was marked as the main event				$hasMainEvent = 0;		$mainEvent = '';		foreach ($matches[1] as $eid) {			if ($eids[$eid]) {				$hasMainEvent = 1;				$mainEvent = $eid;			}		} 		if ($hasMainEvent) {			$MAINEVENTS[$id] = $mainEvent;		}	}		if ($debug) {		print_r($MAINEVENTS);		echo "<p>\n"; }  		foreach ($sentences as $sentence) 	{		$count = $count + 1;		$id = $sentence[1];		$lid = $sentence[2];		$string = $sentence[3];				$string = normalizeEventMarkup($string);#		$string = addRadioButtons($string);		# add-in the radio buttons		$pattern = '/(<EVENT stem="\S+" aspect="\S+" eid="(e\d+))/';		$replacement = "<input type=radio name=$id value=\$2> \$1";		$string = preg_replace($pattern, $replacement, $string);		$numberOfEvents = substr_count($string, '<EVENT ');		# get all events from the sentence		preg_match_all('/eid="(e\d+)"/', $string, $matches);		#echo '<p>'; print_r($matches[1]); echo '<p>';		# see whether one was marked as the main event				$hasMainEvent = 0;		$mainEvent = '';		foreach ($matches[1] as $eid) {			if ($eids[$eid]) {				$hasMainEvent = 1;				$mainEvent = $eid;			}		} 		$string = preg_replace('/<input/', '<xinput', $string);		$string = preg_replace('/<EVENT/', '<XEVENT', $string);		if ($numberOfEvents == 1) {			$pattern = '/<xinput type=radio name=(\d+) value=(e\d+)> <XEVENT/';			$replacement = '<xinput type=radio name=$1 value=$2 checked> <EVENT';			$string = preg_replace($pattern, $replacement, $string);		} elseif ($hasMainEvent == 1) {			$pattern = "/<xinput type=radio name=(\d+) value=($mainEvent)> <XEVENT/";			$replacement = '<xinput type=radio name=$1 value=$2 checked> <EVENT/';			$string = preg_replace($pattern, $replacement, $string);		}		echo "<tr>\n";		echo "  <td valign=top>$id\n";#		echo "  <td valign=top>$mainEvent\n";		echo "  <td valign=top>";		if ($id == 0) {			echo "<TARGETTIMEX3>$string</TARGETTIMEX3>\n";		} else {			echo "$string\n";		}				$mainevent1 = $MAINEVENTS[$id];		$mainevent2 = $MAINEVENTS[$id+1];		if ($mainevent1 and $mainevent2) {			$pair = '(' . $mainevent1 . '-' . $mainevent2 . ')';			$rel = $rels[$pair];					$checkedB = '';			$checkedA = '';			$checkedO = '';			$checkedV = '';			$checkedBO = '';			$checkedOA = '';			$checkedBA = '';			$checkedNR = '';			if ($rel == 'BEFORE') { $checkedB = ' checked'; }			if ($rel == 'AFTER') { $checkedA = ' checked'; }			if ($rel == 'OVERLAP') { $checkedO = ' checked'; }			if ($rel == 'VAGUE') { $checkedV = ' checked'; }			if ($rel == 'BEFORE-OR-OVERLAP') { $checkedBO = ' checked'; }			if ($rel == 'OVERLAP-OR-AFTER') { $checkedOA = ' checked'; }			if ($rel == 'BEFORE-OR-AFTER') { $checkedBA = ' checked'; }			if ($rel == 'NON-RELATED') { $checkedNR = ' checked'; }						echo "<tr>\n";			echo "  <td>&nbsp;\n";			echo "  <td valign=top colspan=2>\n";			if ($debug) { echo "    $pair\n"; }			if (! $rel) {				echo "<font color=red>\n";			}			echo "    <input type=radio name=$pair value=B$checkedB>B\n";			echo "    <input type=radio name=$pair value=O$checkedO>O\n";			echo "    <input type=radio name=$pair value=A$checkedA>A\n";			echo "    <input type=radio name=$pair value=BO$checkedBO>BO\n";			echo "    <input type=radio name=$pair value=OA$checkedOA>OA\n";			echo "    <input type=radio name=$pair value=V$checkedV>V\n";			if (! $rel) {				echo "</font>\n";			}		}			}	echo "</table>\n";?><p><input type="submit" value="Submit Judgements" /></p></FORM><hr><table><tr><td>  <form action="index.php" method="get">  <input type="hidden" name="login" value="<?php echo $login; ?>" />  <input type="submit" value="Home" />  </form><td>  <form action="articles.php" method="get">  <input type="hidden" name="login" value="<?php echo $login; ?>" />  <input type="submit" value="Document List" />  </form></table></body></html>